import requests
from datetime import datetime as dt, timedelta as td
from app import cruise, cruise_methods as cm

auth_token = ''
token_expires = None

def generatepostdataandurl(id, adultcount=2, childcount=0, nonadultages=None, currency='USD'):
    if not nonadultages:
        nonadultages = []

    url = 'https://disneycruise.disney.go.com/wam/cruise-sales-service/view-assembly/' \
                             'cruise-sailings/' + id + ';entityType=cruise-sailing;destination=dcl?region=INTL' \
                             '&view=select-stateroom'
    return url, {"affiliations": [], "region": "INTL", "sailingId": id + ";entityType=cruise-sailing;destination=dcl",
            "partyMix": [{"accessible": 'false', "partyMixId": 0, "orderBuilderId": "null", "adultCount": adultcount,
            "childCount": childcount, "nonAdultAges": nonadultages}], "currency": currency}


def refresh_token():
    global auth_token
    global token_expires

    # return json object with "access_token" and "expires_in" fields (seconds)
    try:
        with requests.session() as c:
            r = c.get("https://disneycruise.disney.go.com/wam/authentication/get-client-token/")  # GET token
            auth_token = r["access_token"]
            token_expires_seconds = r['expires_in']

            token_expires = dt.now() + td(seconds=int(token_expires_seconds))

            return True
    except Exception as e:
        print e
        return False
        # return re.search('token=(.*?);', r.headers['Set-Cookie']).group(1)  # get oauth token from cookie in header


def is_token_expired():
    a=0


def getjsonfrompost(url, data, token=None):
    if token:
        headers = {'Content-Type': "application/json",
                   'Authorization': "BEARER " + token}
        return requests.post(url, json=data, headers=headers).json()
    else:
        return requests.post(url, json=data).json()


def getalllistingids(token):
    url = 'https://disneycruise.disney.go.com/wam/cruise-sales-service/cruise-listing/?region=INTL&storeId=DCL&view=cruise-listing'
    data = {"currency": "USD", "affiliations": [], "partyMix": [{"accessible": "false", "adultCount":2, "childCount": 0,
                                                                 "orderBuilderId": "null", "nonAdultAges":[],
                                                                 "partyMixId":"0"}]}

    j = getjsonfrompost(url, data, token)

    listings = []

    for listing in j['sailings-availability']['sailings']:
        listings.append(j['sailings-availability']['sailings'][str(listing)]['sailingId'].split(';')[0])

    return listings


#t = gettoken()["access_token"]


#ids = ['DM1062']

#c = cm.Cruise.query.filter_by(sailing_id=ids[0]).first()
# print c.name
#
# for r in c.rooms:
#     print str(r.name) + " " + str(r.price)

def getcruisebyid(ids, token):
    for id in ids:

        if not cm.cruiseexists(id):

            url, pdata = generatepostdataandurl(str(id))

            print "got url for id: " + id

            j = getjsonfrompost(url, pdata, token)

            if 'err' in j:
                while j['err']:
                    print "Token expired, getting a new one"
                    #t = gettoken()["access_token"]

                    #j = getjsonfrompost(url, pdata, t)  # retry getting data

            #print "got json for id: " + id

            try:
                cm.createcruise(j["cruise-sailing"])
            except Exception as e:
                print e
                print j
            try:
                cm.createroom(j["sailing-availability"])
            except Exception as e:
                print e
                print j

            print "created objects for cruise and room for id: " + id
        else:
            print "cruise exists: " + id



# with open('cruise_sailing.json') as jd:
#     cruise_sailing = json.load(jd)


# sailing_availability = json.loads("""{"sailingId": "DM1076", "startingFromPriceByPartyMix": [{"stateroomTypes": [{"stateroomSubTypes": [{"startingFromPrice": {"stateroomSubType": "DM-INSIDE-STANDARD;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3461.7", "subtotal": "3080.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-11B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": true, "type": "stateroom-subtype", "id": "DM-INSIDE-STANDARD;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-INSIDE-STANDARD;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3461.7", "subtotal": "3080.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-11B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-INSIDE-STANDARD;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3461.7", "subtotal": "3080.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-11B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-INSIDE-STANDARD;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1730.85", "subtotal": "1540.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3461.7", "subtotal": "3080.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-11B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}, {"startingFromPrice": {"stateroomSubType": "DM-INSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3531.7", "subtotal": "3150.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-10C;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-INSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-INSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1800.85", "subtotal": "1610.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1800.85", "subtotal": "1610.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3601.7", "subtotal": "3220.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-10B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-INSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3531.7", "subtotal": "3150.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-10C;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-INSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1765.85", "subtotal": "1575.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3531.7", "subtotal": "3150.0"}}, "stateroomType": "DM-INSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-10C;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}], "selected": true, "type": "stateroom-type", "id": "DM-INSIDE;entityType=stateroom-type;destination=dcl"}, {"stateroomSubTypes": [{"startingFromPrice": {"stateroomSubType": "DM-OUTSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3671.7", "subtotal": "3290.0"}}, "stateroomType": "DM-OUTSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-09D;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-OUTSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-OUTSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3671.7", "subtotal": "3290.0"}}, "stateroomType": "DM-OUTSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-09D;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-OUTSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1835.85", "subtotal": "1645.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3671.7", "subtotal": "3290.0"}}, "stateroomType": "DM-OUTSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-09D;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-OUTSIDE-DELUXE;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "1870.85", "subtotal": "1680.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "1870.85", "subtotal": "1680.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "3741.7", "subtotal": "3360.0"}}, "stateroomType": "DM-OUTSIDE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-09C;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}], "selected": false, "type": "stateroom-type", "id": "DM-OUTSIDE;entityType=stateroom-type;destination=dcl"}, {"stateroomSubTypes": [{"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEOCEANVIEW;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2290.85", "subtotal": "2100.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2290.85", "subtotal": "2100.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "4581.7", "subtotal": "4200.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-07A;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-VERANDAH-DELUXEOCEANVIEW;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEOCEANVIEW;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2570.85", "subtotal": "2380.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2570.85", "subtotal": "2380.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5141.7", "subtotal": "4760.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-05B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEOCEANVIEW;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2535.85", "subtotal": "2345.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2535.85", "subtotal": "2345.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5071.7", "subtotal": "4690.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-05C;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEOCEANVIEW;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2290.85", "subtotal": "2100.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2290.85", "subtotal": "2100.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "4581.7", "subtotal": "4200.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-07A;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}, {"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEFAMILY;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2885.85", "subtotal": "2695.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2885.85", "subtotal": "2695.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5771.7", "subtotal": "5390.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-04E;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-VERANDAH-DELUXEFAMILY;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEFAMILY;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2990.85", "subtotal": "2800.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2990.85", "subtotal": "2800.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5981.7", "subtotal": "5600.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-04A;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEFAMILY;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2920.85", "subtotal": "2730.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2920.85", "subtotal": "2730.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5841.7", "subtotal": "5460.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-04B;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-VERANDAH-DELUXEFAMILY;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "2885.85", "subtotal": "2695.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "2885.85", "subtotal": "2695.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "5771.7", "subtotal": "5390.0"}}, "stateroomType": "DM-VERANDAH;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-04E;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}], "selected": false, "type": "stateroom-type", "id": "DM-VERANDAH;entityType=stateroom-type;destination=dcl"}, {"stateroomSubTypes": [{"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ONE-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "9761.7", "subtotal": "9380.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00T;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-SUITE-CONCIERGE-ONE-BEDROOM;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ONE-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "9761.7", "subtotal": "9380.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00T;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}, {"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ONE-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "9761.7", "subtotal": "9380.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00T;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}, {"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ONE-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "AFT", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "4880.85", "subtotal": "4690.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "9761.7", "subtotal": "9380.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00T;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "AFT"}]}, {"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-TWO-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "8590.85", "subtotal": "8400.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "8590.85", "subtotal": "8400.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "17181.7", "subtotal": "16800.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00S;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-SUITE-CONCIERGE-TWO-BEDROOM;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-TWO-BEDROOM;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "FORWARD", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "8590.85", "subtotal": "8400.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "8590.85", "subtotal": "8400.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "17181.7", "subtotal": "16800.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00S;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "FORWARD"}]}, {"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ROYAL;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "9640.85", "subtotal": "9450.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "9640.85", "subtotal": "9450.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "19281.7", "subtotal": "18900.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00R;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "type": "stateroom-subtype", "id": "DM-SUITE-CONCIERGE-ROYAL;entityType=stateroom-subtype;destination=dcl", "locations": [{"startingFromPrice": {"stateroomSubType": "DM-SUITE-CONCIERGE-ROYAL;entityType=stateroom-subtype;destination=dcl", "stateroomLocation": "MID", "price": {"promoCode": "EBS;entityType=marketing-offer;destination=dcl", "breakdownByGuest": [{"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "1", "total": "9640.85", "subtotal": "9450.0", "ageGroup": "ADULT"}, {"tax": "190.85", "taxIncluded": true, "currency": "USD", "guestId": "2", "total": "9640.85", "subtotal": "9450.0", "ageGroup": "ADULT"}], "rateType": "rack", "summary": {"taxIncluded": true, "currency": "USD", "tax": "381.7", "total": "19281.7", "subtotal": "18900.0"}}, "stateroomType": "DM-SUITE;entityType=stateroom-type;destination=dcl", "stateroomCategory": "DM-00R;entityType=stateroom-category;destination=dcl", "offerType": "REGULAR"}, "selected": false, "id": "MID"}]}], "selected": false, "type": "stateroom-type", "id": "DM-SUITE;entityType=stateroom-type;destination=dcl"}], "partyMixId": "1"}], "package": {"packageCode": "7SN", "packageID": "23233500"}}""")





